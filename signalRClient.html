<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Document</title>
</head>
<body>

<div class="container">

    <div class="row">&nbsp;</div>

    <div class="row">

        <div class="col-2">User</div>

        <div class="col-4"><input type="text" id="userInput" /></div>

    </div>

    <div class="row">

        <div class="col-2">Message</div>

        <div class="col-4"><input type="text" id="messageInput" /></div>

    </div>

    <div class="row">&nbsp;</div>

    <div class="row">

        <div class="col-6">

            <input type="button" id="sendButton" value="Send Message" />

        </div>

    </div>

</div>

<div class="row">

    <div class="col-12">

        <hr />

    </div>

</div>

<div class="row">

    <div class="col-6">

        <ul id="messagesList"></ul>

    </div>

</div>

</body>
<script src="signalr.min.js"></script>
<script type = "text/javascript">

"use strict";

const BASE_URL_QA = 'http://5.183.11.4:82';
const BASE_URL_PRODUCTION = 'http://5.183.11.4:81';
const BASE_URL_LOCAL = 'http://localhost:5000';
const ENDPOINT_NOTIFICATION = '/notificationHub';
const ENDPOINT_STATUS = '/statusHub';

console.log(BASE_URL_QA+ENDPOINT_NOTIFICATION);

var connection = new signalR.HubConnectionBuilder()
 .withUrl(BASE_URL_QA+ENDPOINT_STATUS, {
  skipNegotiation : true,
  withCredentials : false,
  transport : signalR.HttpTransportType.WebSockets
}).build();



//Disable send button until connection is established

document.getElementById("sendButton").disabled = true;



connection.on("ReceiveMessage", function (user, message) {

    var msg = message.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

    var encodedMsg = user + " says " + msg;

    var li = document.createElement("li");

    li.textContent = encodedMsg;

    document.getElementById("messagesList").appendChild(li);

});



connection.start().then(function () {

    document.getElementById("sendButton").disabled = false;

}).catch(function (err) {

    return console.error(err.toString());

});



document.getElementById("sendButton").addEventListener("click", function (event) {

    var user = document.getElementById("userInput").value;

    var message = document.getElementById("messageInput").value;

    connection.invoke("SendMessage", user, message).catch(function (err) {

        return console.error(err.toString());

    });

    event.preventDefault();

});	 	

</script>
</html>
